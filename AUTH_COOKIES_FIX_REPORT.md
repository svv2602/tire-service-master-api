# Отчет об исправлении проблемы с авторизацией

## Проблема

При попытке входа в систему возникала ошибка 500 (Internal Server Error). Пользователь не мог авторизоваться в приложении.

## Анализ

1. В логах Rails API была обнаружена ошибка:
```
NameError (undefined local variable or method `cookies' for an instance of Api::V1::AuthController)
app/controllers/api/v1/auth_controller.rb:18:in `login'
```

2. Проблема возникала из-за того, что в контроллере `AuthController` использовался метод `cookies`, но не была включена поддержка cookies в Rails API.

3. Дополнительная проблема: CORS настройки не включали порт 8000, на котором запущен API сервер.

## Решение

1. Добавлена поддержка cookies в `ApplicationController`:
```ruby
include ActionController::Cookies
```

2. Добавлен порт 8000 в список разрешенных origins в CORS настройках:
```ruby
origins 'localhost:3000', '127.0.0.1:3000',
        'localhost:5173', '127.0.0.1:5173',
        'localhost:8080', '127.0.0.1:8080',
        'localhost:3008', '127.0.0.1:3008',
        'localhost:8000', '127.0.0.1:8000',
        '192.168.9.109:3008'
```

## Результат

1. Авторизация работает корректно
2. Система сохраняет refresh токен в HttpOnly cookies
3. Access токен передается в ответе и сохраняется на клиенте

## Рекомендации

1. Обновить документацию API с описанием механизма аутентификации
2. Добавить тесты для проверки работы аутентификации
3. Рассмотреть возможность использования более безопасных механизмов хранения токенов на клиенте 