<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .request-data {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            border-left: 4px solid #007bff;
        }
        .response-data {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        .success {
            border-left: 4px solid #28a745;
        }
        .error {
            border-left: 4px solid #dc3545;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin-left: 10px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
    </div>

    <!-- –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="container">
        <div class="test-section">
            <h3>–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º API check_exists –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏ email</p>
            <button onclick="testCheckUserExists()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
            <span id="test1-status" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            
            <div class="request-data" id="test1-request"></div>
            <div class="response-data" id="test1-response"></div>
        </div>
    </div>

    <!-- –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
    <div class="container">
        <div class="test-section">
            <h3>–¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</h3>
            <p>–ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
            <button onclick="testCreateBookingExistingUser()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
            <span id="test2-status" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            
            <div class="request-data" id="test2-request"></div>
            <div class="response-data" id="test2-response"></div>
        </div>
    </div>

    <!-- –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å client_id -->
    <div class="container">
        <div class="test-section">
            <h3>–¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å client_id</h3>
            <p>–°–æ–∑–¥–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—Ä–µ–¥–∞–≤–∞—è client_id –≤–º–µ—Å—Ç–æ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞</p>
            <button onclick="testCreateBookingWithClientId()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
            <span id="test3-status" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            
            <div class="request-data" id="test3-request"></div>
            <div class="response-data" id="test3-response"></div>
        </div>
    </div>

    <!-- –¢–µ—Å—Ç 4: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
    <div class="container">
        <div class="test-section">
            <h3>–¢–µ—Å—Ç 4: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</h3>
            <p>–°–æ–∑–¥–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
            <button onclick="testCreateBookingNewUser()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
            <span id="test4-status" class="status pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            
            <div class="request-data" id="test4-request"></div>
            <div class="response-data" id="test4-response"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showRequest(testId, data) {
            document.getElementById(`${testId}-request`).textContent = 
                'REQUEST:\n' + JSON.stringify(data, null, 2);
        }

        function showResponse(testId, response, isError = false) {
            const element = document.getElementById(`${testId}-response`);
            const statusElement = document.getElementById(`${testId}-status`);
            
            element.textContent = 'RESPONSE:\n' + JSON.stringify(response, null, 2);
            element.className = `response-data ${isError ? 'error' : 'success'}`;
            
            statusElement.textContent = isError ? '–û—à–∏–±–∫–∞' : '–£—Å–ø–µ—Ö';
            statusElement.className = `status ${isError ? 'error' : 'success'}`;
        }

        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function testCheckUserExists() {
            const testId = 'test1';
            const statusElement = document.getElementById(`${testId}-status`);
            statusElement.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
            statusElement.className = 'status pending';

            const requestData = {
                phone: '+380671234567',
                email: 'test@test.com'
            };

            showRequest(testId, requestData);

            try {
                const response = await fetch(`${API_BASE}/users/check_exists?${new URLSearchParams(requestData)}`);
                const result = await response.json();
                showResponse(testId, result, !response.ok);
            } catch (error) {
                showResponse(testId, { error: error.message }, true);
            }
        }

        // –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        async function testCreateBookingExistingUser() {
            const testId = 'test2';
            const statusElement = document.getElementById(`${testId}-status`);
            statusElement.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
            statusElement.className = 'status pending';

            const requestData = {
                client: {
                    first_name: "–¢–µ—Å—Ç",
                    last_name: "–¢–µ—Å—Ç–æ–≤",
                    phone: "+380671234567",
                    email: "test@test.com"
                },
                booking: {
                    service_point_id: 44,
                    service_category_id: 6,
                    booking_date: "2025-01-28",
                    start_time: "10:00",
                    service_recipient_first_name: "–¢–µ—Å—Ç",
                    service_recipient_last_name: "–¢–µ—Å—Ç–æ–≤",
                    service_recipient_phone: "+380671234567",
                    service_recipient_email: "test@test.com",
                    notes: "–¢–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"
                },
                car: {
                    car_type_id: 1
                }
            };

            showRequest(testId, requestData);

            try {
                const response = await fetch(`${API_BASE}/client_bookings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                const result = await response.json();
                showResponse(testId, result, !response.ok);
            } catch (error) {
                showResponse(testId, { error: error.message }, true);
            }
        }

        // –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å client_id
        async function testCreateBookingWithClientId() {
            const testId = 'test3';
            const statusElement = document.getElementById(`${testId}-status`);
            statusElement.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
            statusElement.className = 'status pending';

            const requestData = {
                client_id: 1, // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
                booking: {
                    service_point_id: 44,
                    service_category_id: 6,
                    booking_date: "2025-01-28",
                    start_time: "11:00",
                    service_recipient_first_name: "–¢–µ—Å—Ç",
                    service_recipient_last_name: "–¢–µ—Å—Ç–æ–≤",
                    service_recipient_phone: "+380671234567",
                    service_recipient_email: "test@test.com",
                    notes: "–¢–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å client_id"
                },
                car: {
                    car_type_id: 1
                }
            };

            showRequest(testId, requestData);

            try {
                const response = await fetch(`${API_BASE}/client_bookings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                const result = await response.json();
                showResponse(testId, result, !response.ok);
            } catch (error) {
                showResponse(testId, { error: error.message }, true);
            }
        }

        // –¢–µ—Å—Ç 4: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        async function testCreateBookingNewUser() {
            const testId = 'test4';
            const statusElement = document.getElementById(`${testId}-status`);
            statusElement.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
            statusElement.className = 'status pending';

            const timestamp = Date.now();
            const requestData = {
                client: {
                    first_name: "–ù–æ–≤—ã–π",
                    last_name: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                    phone: `+38067${timestamp.toString().slice(-7)}`,
                    email: `newuser${timestamp}@test.com`
                },
                booking: {
                    service_point_id: 44,
                    service_category_id: 6,
                    booking_date: "2025-01-28",
                    start_time: "12:00",
                    service_recipient_first_name: "–ù–æ–≤—ã–π",
                    service_recipient_last_name: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                    service_recipient_phone: `+38067${timestamp.toString().slice(-7)}`,
                    service_recipient_email: `newuser${timestamp}@test.com`,
                    notes: "–¢–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                },
                car: {
                    car_type_id: 1
                }
            };

            showRequest(testId, requestData);

            try {
                const response = await fetch(`${API_BASE}/client_bookings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                const result = await response.json();
                showResponse(testId, result, !response.ok);
            } catch (error) {
                showResponse(testId, { error: error.message }, true);
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
        window.onload = function() {
            setTimeout(testCheckUserExists, 1000);
        };
    </script>
</body>
</html> 