<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–∑—ã–≤–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        .get-btn { background-color: #007bff; color: white; border: none; }
        .update-btn { background-color: #28a745; color: white; border: none; }
        .pending-btn { background-color: #ffc107; color: black; border: none; }
        .rejected-btn { background-color: #dc3545; color: white; border: none; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .status-indicator { 
            display: inline-block; 
            padding: 2px 8px; 
            border-radius: 3px; 
            font-size: 12px; 
            font-weight: bold; 
        }
        .status-published { background-color: #28a745; color: white; }
        .status-pending { background-color: #ffc107; color: black; }
        .status-rejected { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–∑—ã–≤–∞</h1>
        <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–∑—ã–≤–∞</p>

        <div class="test-section">
            <h3>üîê 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            <button class="get-btn" onclick="login()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>
            <div id="auth-result"></div>
        </div>

        <div class="test-section">
            <h3>üìñ 2. –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
            <button class="get-btn" onclick="getReview()">GET /api/v1/reviews/10</button>
            <div id="get-result"></div>
        </div>

        <div class="test-section">
            <h3>‚úèÔ∏è 3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</h3>
            <button class="pending-btn" onclick="updateStatus('pending')">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏"</button>
            <button class="rejected-btn" onclick="updateStatus('rejected')">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "–û—Ç–∫–ª–æ–Ω—ë–Ω"</button>
            <button class="update-btn" onclick="updateStatus('published')">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω"</button>
            <div id="update-result"></div>
        </div>

        <div class="test-section">
            <h3>üîç 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</h3>
            <button class="get-btn" onclick="checkStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</button>
            <div id="check-result"></div>
        </div>
    </div>

    <script>
        let authToken = '';

        function formatStatus(status) {
            const statusClass = `status-${status}`;
            return `<span class="${statusClass}">${status.toUpperCase()}</span>`;
        }

        async function login() {
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        auth: {
                            login: 'admin@test.com',
                            password: 'admin123'
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    document.getElementById('auth-result').innerHTML = `
                        <div class="success">
                            ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞<br>
                            –¢–æ–∫–µ–Ω: ${authToken.substring(0, 20)}...
                        </div>
                    `;
                } else {
                    document.getElementById('auth-result').innerHTML = `
                        <div class="error">‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${data.message}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('auth-result').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
            }
        }

        async function getReview() {
            if (!authToken) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å!');
                return;
            }

            try {
                const response = await fetch('http://localhost:8000/api/v1/reviews/10', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('get-result').innerHTML = `
                        <div class="success">
                            ‚úÖ –û—Ç–∑—ã–≤ –ø–æ–ª—É—á–µ–Ω<br>
                            ID: ${data.id}<br>
                            –†–µ–π—Ç–∏–Ω–≥: ${data.rating}‚≠ê<br>
                            –°—Ç–∞—Ç—É—Å: ${formatStatus(data.status)}<br>
                            is_published: ${data.is_published}<br>
                            –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "${data.comment}"
                        </div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('get-result').innerHTML = `
                        <div class="error">‚ùå –û—à–∏–±–∫–∞: ${data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('get-result').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
            }
        }

        async function updateStatus(status) {
            if (!authToken) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å!');
                return;
            }

            try {
                const response = await fetch('http://localhost:8000/api/v1/reviews/10', {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        review: {
                            rating: 5,
                            comment: `üß™ –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${status} (${new Date().toLocaleString()})`,
                            status: status
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('update-result').innerHTML = `
                        <div class="success">
                            ‚úÖ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞: ${formatStatus(data.status)}<br>
                            is_published: ${data.is_published}<br>
                            –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${new Date(data.updated_at).toLocaleString()}
                        </div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('update-result').innerHTML = `
                        <div class="error">‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${data.message || JSON.stringify(data)}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('update-result').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
            }
        }

        async function checkStatus() {
            await getReview();
            
            // –ö–æ–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–µ–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏
            const getResult = document.getElementById('get-result').innerHTML;
            document.getElementById('check-result').innerHTML = getResult;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = () => {
            console.log('üß™ –¢–µ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–∑—ã–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω');
            console.log('–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω"');
        };
    </script>
</body>
</html> 